/**
 * skylark-langx-async - The skylark JavaScript language extension library.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx-arrays","skylark-langx-funcs","skylark-langx-objects","./async"],function(t,e,r,n){"use strict";var i=Array.prototype.slice,o=e.proxy,s=t.makeArray,u=r.result;(0,r.mixin)(Promise.prototype,{always:function(t){return this.then(t,t),this},done:function(){for(var t=0;t<arguments.length;t++)this.then(arguments[t]);return this},fail:function(t){return this.catch(t),this}});var c=function(){var t=this;this.promise=p(new Promise(function(e,r){t._resolve=e,t._reject=r}))};function p(t){if(t.isResolved)return t;var e=!0,r=!1,n=!1,i=t.then(function(t){return n=!0,e=!1,t},function(t){throw r=!0,e=!1,t});i.isResolved=function(){return n},i.isPending=function(){return e},i.isRejected=function(){return r},i.state=function(){return n?"resolved":r?"rejected":"pending"};var o=[],s=[];return i.then=function(t,e,r){return r&&this.progress(r),p(Promise.prototype.then.call(this,t&&function(e){return e&&void 0!==e.__ctx__?t.apply(e.__ctx__,e):t(e)},e&&function(t){return t&&void 0!==t.__ctx__?e.apply(t.__ctx__,t):e(t)}))},i.progress=function(t){return o.forEach(function(e){t(e)}),s.push(t),this},i.pipe=i.then,i.notify=function(t){try{return o.push(t),s.forEach(function(e){return e(t)})}catch(t){this.reject(t)}return this},i}return c.prototype.resolve=function(t){var e=i.call(arguments);return this.resolveWith(null,e)},c.prototype.resolveWith=function(t,e){return(e=e?s(e):[]).__ctx__=t,this._resolve(e),this._resolved=!0,this},c.prototype.notify=function(t){return u(this,"promise").notify(t),this},c.prototype.reject=function(t){var e=i.call(arguments);return this.rejectWith(null,e)},c.prototype.rejectWith=function(t,e){return(e=e?s(e):[]).__ctx__=t,this._reject(e),this._rejected=!0,this},c.prototype.isResolved=function(){return u(this,"promise").isResolved()},c.prototype.isRejected=function(){return u(this,"promise").isRejected()},c.prototype.state=function(){return u(this,"promise").state()},c.prototype.then=function(t,e,r){return u(this,"promise").then(t,e,r)},c.prototype.progress=function(t){return u(this,"promise").progress(t)},c.prototype.catch=function(t){return u(this,"promise").catch(t)},c.prototype.always=function(){var t=u(this,"promise");return t.always.apply(t,arguments),this},c.prototype.done=function(){var t=u(this,"promise");return t.done.apply(t,arguments),this},c.prototype.fail=function(t){return u(this,"promise").fail(t),this},c.all=function(t){var e=new c;return Promise.all(t).then(e.resolve.bind(e),e.reject.bind(e)),u(e,"promise")},c.first=function(t){return p(Promise.race(t))},c.when=function(t,e,r,n){var i=t&&"function"==typeof t.then,s=i&&t instanceof Promise;if(!i)return arguments.length>1?e?e(t):t:(new c).resolve(t);if(!s){var u=new c(t.cancel);t.then(o(u.resolve,u),o(u.reject,u),u.notify),t=u.promise}return e||r||n?t.then(e,r,n):t},c.reject=function(t){var e=new c;return e.reject(t),e.promise},c.immediate=c.resolve=function(t){var e=new c;return e.resolve.apply(e,arguments),e.promise},c.promise=function(t){var e=new c;return t(e.resolve.bind(e),e.reject.bind(e),e.progress.bind(e)),e.promise},n.Deferred=c});
//# sourceMappingURL=sourcemaps/deferred.js.map
